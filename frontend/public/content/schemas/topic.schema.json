{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "topic.schema.json",
  "title": "Topic",
  "description": "A learning topic within a phase, containing ordered learning steps.",
  "type": "object",
  "required": [
    "id",
    "slug",
    "name",
    "description",
    "order",
    "is_capstone",
    "learning_steps"
  ],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "minLength": 1,
      "description": "Unique topic identifier within the phase."
    },
    "slug": {
      "type": "string",
      "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
      "description": "URL-safe topic slug, e.g. 'cloud-computing'."
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "description": "Human-readable topic name."
    },
    "description": {
      "type": "string",
      "minLength": 1,
      "description": "Topic description shown at the top of the topic page."
    },
    "short_description": {
      "type": "string",
      "description": "Optional one-line summary for topic cards."
    },
    "order": {
      "type": "integer",
      "minimum": 1,
      "description": "Display order within the phase."
    },
    "is_capstone": {
      "type": "boolean",
      "description": "Whether this topic is the phase capstone project."
    },
    "learning_steps": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/LearningStep" },
      "description": "Ordered learning steps. Each step.order must be sequential starting at 1."
    }
  },
  "$defs": {
    "LearningStep": {
      "type": "object",
      "required": ["order", "text", "action"],
      "additionalProperties": false,
      "description": "A single learning step. Must have at least one content source: url, description, code, options, checklist, or secondary_links.",
      "properties": {
        "order": {
          "type": "integer",
          "minimum": 1,
          "description": "Sequential position (1-based, no gaps or duplicates)."
        },
        "text": {
          "type": "string",
          "minLength": 1,
          "description": "Primary display text shown next to the checkbox. Used as the step's label when there is no separate title."
        },
        "action": {
          "type": "string",
          "minLength": 1,
          "description": "Bold action prefix shown before the title/text (e.g. 'Read', 'Watch', 'Practice'). When the step has a title, action is the verb and title is the display name. When there is no title, action IS the full display name."
        },
        "title": {
          "type": "string",
          "description": "Display name shown after the action verb. Use when the action is a verb prefix (e.g. action='Read' title='Cloud Computing Fundamentals'). Must NOT duplicate the text field."
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Primary external resource URL. Required when the step directs learners to an external resource (article, video, docs). Omit for self-contained steps whose content is in description/code/options."
        },
        "description": {
          "type": "string",
          "description": "Expanded content shown when the step is expanded. Rendered as markdown â€” use `-` for bullet lists, `1.` for numbered lists, `**bold**`, and `[text](url)` for links."
        },
        "checklist": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Structured checklist items displayed as a sub-list under the step."
        },
        "code": {
          "type": "string",
          "description": "Code snippet displayed in a code block."
        },
        "secondary_links": {
          "type": "array",
          "items": { "$ref": "#/$defs/SecondaryLink" },
          "description": "Additional reference links shown below the description."
        },
        "options": {
          "type": "array",
          "items": { "$ref": "#/$defs/ProviderOption" },
          "description": "Cloud provider-specific alternatives (AWS/Azure/GCP tabs)."
        }
      }
    },
    "SecondaryLink": {
      "type": "object",
      "required": ["text", "url"],
      "additionalProperties": false,
      "properties": {
        "text": {
          "type": "string",
          "description": "Link display text."
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Link target URL."
        }
      }
    },
    "ProviderOption": {
      "type": "object",
      "required": ["provider", "title", "url"],
      "additionalProperties": false,
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["aws", "azure", "gcp"],
          "description": "Cloud provider identifier."
        },
        "title": {
          "type": "string",
          "description": "Option title, e.g. 'Get Started with Amazon EC2'."
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Provider-specific resource URL."
        },
        "description": {
          "type": "string",
          "description": "Optional description of this provider option. Rendered as markdown."
        }
      }
    }
  }
}
