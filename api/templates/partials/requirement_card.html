<!-- Requirement card for hands-on verification -->
<div id="requirement-{{ requirement.id }}" class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
    <div class="flex items-center justify-between mb-2">
        <h4 class="font-medium text-gray-900 dark:text-gray-100">{{ requirement.name }}</h4>
        {% if submission and submission.is_validated %}
        <span class="inline-flex items-center rounded-full bg-green-100 dark:bg-green-900 px-2.5 py-0.5 text-xs font-medium text-green-800 dark:text-green-200">
            ✓ Verified
        </span>
        {% elif submission and not submission.is_validated and server_error %}
        <span class="inline-flex items-center rounded-full bg-amber-100 dark:bg-amber-900 px-2.5 py-0.5 text-xs font-medium text-amber-800 dark:text-amber-200">
            ⚠ Service Error
        </span>
        {% elif submission and not submission.is_validated %}
        <span class="inline-flex items-center rounded-full bg-red-100 dark:bg-red-900 px-2.5 py-0.5 text-xs font-medium text-red-800 dark:text-red-200">
            ✗ Failed
        </span>
        {% endif %}
    </div>

    {% if requirement.description %}
    <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">{{ requirement.description }}</p>
    {% endif %}

    {% if not submission or not submission.is_validated %}
    <form
        hx-post="/htmx/github/submit"
        hx-target="#requirement-{{ requirement.id }}"
        hx-swap="outerHTML"
        hx-indicator="#spinner-{{ requirement.id }}"
        class="flex gap-2"
    >
        <input type="hidden" name="requirement_id" value="{{ requirement.id }}">
        <input type="hidden" name="phase_id" value="{{ phase_id }}">
        <input type="hidden" name="submission_type" value="{{ requirement.submission_type }}">

        {% if requirement.submission_type in ['ctf_token', 'networking_token'] %}
        <input
            type="text"
            name="submitted_value"
            placeholder="{{ requirement.placeholder | default('Paste your completion token here') }}"
            value="{% if submission %}{{ submission.submitted_value }}{% endif %}"
            class="flex-1 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-sm placeholder-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
            required
        >
        {% else %}
        <input
            type="url"
            name="submitted_value"
            placeholder="{{ requirement.placeholder | default('https://github.com/username/repo') }}"
            value="{% if submission %}{{ submission.submitted_value }}{% endif %}"
            class="flex-1 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-sm placeholder-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
            required
        >
        {% endif %}

        <button
            type="submit"
            class="inline-flex items-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white hover:bg-blue-500 disabled:opacity-50"
        >
            Verify
        </button>
        <span id="spinner-{{ requirement.id }}" class="htmx-indicator inline-flex items-center text-sm text-gray-500">
            Checking...
        </span>
    </form>
    {% endif %}

    {% if server_error %}
    <div class="mt-3 rounded-md bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 p-3">
        <p class="text-sm text-amber-800 dark:text-amber-200">
            ⚠ {{ server_error_message or 'The verification service encountered an error.' }}
            <strong>This attempt was not counted against your rate limit</strong> — you can try again immediately.
        </p>
    </div>
    {% endif %}

    {% if error_banner %}
    <div class="mt-3 rounded-md bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-3">
        <p class="text-sm text-red-800 dark:text-red-200">{{ error_banner }}</p>
    </div>
    {% endif %}

    {% if feedback_tasks %}
    {% with feedback_tasks=feedback_tasks, feedback_passed=feedback_passed, requirement_id=requirement.id %}
    {% include "partials/verification_feedback.html" %}
    {% endwith %}
    {% endif %}

    {% if cooldown_seconds %}
    {% with retry_after_seconds=cooldown_seconds, cooldown_message=cooldown_message %}
    {% include "partials/cooldown_timer.html" %}
    {% endwith %}
    {% endif %}
</div>
