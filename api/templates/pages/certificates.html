{% extends "layouts/content_page.html" %}
{% block title %}Certificates - Learn to Cloud{% endblock %}

{% block page_header %}
<h1 class="text-3xl font-bold text-gray-900 dark:text-white">Certificates</h1>
{% endblock %}

{% block page_body %}
{% if eligible and not certificate %}
<div class="mb-8 p-6 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800">
    <h2 class="font-semibold text-green-800 dark:text-green-200 mb-2">ğŸ‰ You're eligible for a certificate!</h2>
    <p class="text-sm text-green-700 dark:text-green-300 mb-4">You've completed all phases. Generate your certificate now.</p>
    <form hx-post="/htmx/certificates" hx-target="#certificates-list" hx-swap="afterbegin">
        <input type="hidden" name="recipient_name" value="{{ user.first_name }} {{ user.last_name }}">
        <button type="submit" class="rounded-md bg-green-600 px-4 py-2 text-sm font-semibold text-white hover:bg-green-500">
            Generate Certificate
        </button>
    </form>
</div>
{% elif not eligible and not certificate %}
<div class="mb-8 p-6 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
    <p class="text-gray-600 dark:text-gray-400">Complete all phases to earn your certificate.</p>
</div>
{% endif %}

<!-- Existing certificate -->
<div id="certificates-list" class="space-y-4">
    {% if certificate %}
    <div class="p-6 rounded-lg border border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold text-gray-900 dark:text-white">Full Completion</h3>
            <span class="text-sm text-gray-500 dark:text-gray-400">Issued {{ certificate.issued_at.strftime('%B %d, %Y') }}</span>
        </div>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
            Recipient: {{ certificate.recipient_name }} Â· Verification code:
            <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded-sm text-xs">{{ certificate.verification_code }}</code>
            <button
                x-data="{ copied: false }"
                @click="
                    const text = '{{ certificate.verification_code }}';
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(text).then(() => { copied = true; setTimeout(() => copied = false, 2000); });
                    } else {
                        const ta = document.createElement('textarea');
                        ta.value = text; ta.style.position = 'fixed'; ta.style.opacity = '0';
                        document.body.appendChild(ta); ta.select(); document.execCommand('copy');
                        document.body.removeChild(ta); copied = true; setTimeout(() => copied = false, 2000);
                    }
                "
                class="ml-1 text-blue-600 dark:text-blue-400 text-xs hover:underline"
                x-text="copied ? 'Copied!' : 'Copy'"
                aria-label="Copy verification code"
            ></button>
        </p>
        <div class="flex gap-3">
            <a href="/api/certificates/mine/pdf" download hx-boost="false" class="text-sm font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400">
                ğŸ“„ Download PDF
            </a>
            <a href="/api/certificates/mine/png" download hx-boost="false" class="text-sm font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400">
                ğŸ–¼ï¸ Download PNG
            </a>
            <a href="/verify/{{ certificate.verification_code }}" class="text-sm font-medium text-gray-600 hover:text-gray-500 dark:text-gray-400">
                ğŸ”— Verification link
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
